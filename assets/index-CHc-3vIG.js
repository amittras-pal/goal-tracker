import{r as y,b as v,Q as D,j as t,z as B,f as q,J as H,l as Q,B as X,q as N,T as Y,n as j,S as K}from"./index--_GJNTul.js";import{u as W,F as Z,A as ee}from"./Alert-C21dZ37v.js";import{b as te,d as O,I as se}from"./InputBase-DYrbb2l-.js";const oe={multiple:!1},T=y.forwardRef((e,o)=>{const{onChange:n,children:s,multiple:a,accept:m,name:l,form:r,resetRef:i,disabled:d,capture:h,inputProps:p,...R}=v("FileButton",oe,e),f=y.useRef(null),b=()=>{var u;!d&&((u=f.current)==null||u.click())},g=u=>{n(a?Array.from(u.currentTarget.files):u.currentTarget.files[0]||null)};return D(i,()=>{f.current&&(f.current.value="")}),t.jsxs(t.Fragment,{children:[s({onClick:b,...R}),t.jsx("input",{style:{display:"none"},type:"file",accept:m,multiple:a,onChange:g,ref:B(o,f),name:l,form:r,capture:h,...p})]})});T.displayName="@mantine/core/FileButton";const ne=({value:e})=>t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Array.isArray(e)?e.map(o=>o.name).join(", "):e==null?void 0:e.name}),ae={valueComponent:ne},F=q((e,o)=>{const n=v("FileInput",ae,e),{unstyled:s,vars:a,onChange:m,value:l,defaultValue:r,multiple:i,accept:d,name:h,form:p,valueComponent:R,clearable:f,clearButtonProps:b,readOnly:g,capture:C,fileInputProps:u,rightSection:G,size:S,placeholder:k,component:L,resetRef:U,classNames:I,styles:A,...V}=n,x=y.useRef(null),{resolvedClassNames:z,resolvedStyles:J}=W({classNames:I,styles:A,props:n}),[c,E]=te({value:l,defaultValue:r,onChange:m,finalValue:i?[]:null}),P=Array.isArray(c)?c.length!==0:c!==null,M=G||(f&&P&&!g?t.jsx(H,{...b,variant:"subtle",onClick:()=>E(i?[]:null),size:S,unstyled:s}):null);y.useEffect(()=>{var w;(Array.isArray(c)&&c.length===0||c===null)&&((w=x.current)==null||w.call(x))},[c]);const $=R;return t.jsx(T,{onChange:E,multiple:i,accept:d,name:h,form:p,resetRef:B(x,U),disabled:g,capture:C,inputProps:u,children:w=>t.jsx(O,{component:L||"button",ref:o,rightSection:M,...w,...V,__staticSelector:"FileInput",multiline:!0,type:"button",pointer:!0,__stylesApiProps:n,unstyled:s,size:S,classNames:I,styles:A,children:P?t.jsx($,{value:c}):t.jsx(se.Placeholder,{__staticSelector:"FileInput",classNames:z,styles:J,children:k})})})});F.classes=O.classes;F.displayName="@mantine/core/FileInput";const re=F,le="The File Name is modified and cannot be accepted to load your goals. Please ensure the file name is exactly as it had been exported as.",ie="The content of the file has been modified after being exported. Please export again and do not modify the file content before importing.",ce="Please ensure the file is not modified in any way before importing on another device.";async function _(e){const o=await window.crypto.subtle.digest("SHA-256",new TextEncoder().encode(e));return Array.from(new Uint8Array(o)).map(s=>s.toString(16).padStart(2,"0")).join("")}function ue(e,o){const n=new Blob([JSON.stringify(e)],{type:"application/json"}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=`Export-${o}.json`,a.click(),URL.revokeObjectURL(s),a.remove()}function me(){const{goals:e,saveGoals:o}=Q(),[n,s]=y.useState(!1),a=async()=>{const l=await _(JSON.stringify(e));ue(e,l),j.show({title:"File Exported",message:ce,color:"yellow"})},m=l=>{const r=new FileReader;l&&(r.readAsText(l),r.onload=async()=>{var i;if(r.result&&typeof r.result=="string"){const d=(i=l.name.split("-").at(-1))==null?void 0:i.replace(".json","");if(!/^[0-9a-f]{64}$/.test(d??"")){j.show({title:"File Name Modified",color:"red",message:le,autoClose:1e4});return}const h=await _(r.result);if(d!==h){j.show({title:"File Modified or Renamed",color:"red",autoClose:7500,message:ie});return}o([]);const p=JSON.parse(r.result);o(K(p,"title")),j.show({title:`${p.length} Goals Imported.`,message:"Your goals from file have been imported successfully.",color:"green"}),s(!1)}})};return t.jsxs(X,{ms:"auto",children:[!n&&t.jsxs(Z,{gap:"sm",children:[e.length>0&&t.jsx(N,{size:"xs",onClick:a,children:"Export Goals"}),t.jsx(N,{size:"xs",onClick:()=>s(!0),children:"Import Goals"})]}),n&&t.jsxs(ee,{color:"indigo",radius:"md",title:"Import Goals",withCloseButton:!0,onClose:()=>s(!1),children:[t.jsx(re,{label:"Select Goals File",description:"Select the file you exported from your other device.",placeholder:"Select Goals File",onChange:m}),t.jsx(Y,{mt:"md",c:"red",children:"Please note that importing goals from file will replace any goals you already had created in the system. This action cannot be undone."})]})]})}export{me as default};
