import{r as y,b as _,Q as D,j as t,z as v,f as q,J as H,l as Q,B as X,q as P,T as Y,n as j}from"./index-hH5uK6qP.js";import{u as K,F as W,A as Z}from"./Alert-C1iKgN1K.js";import{b as ee,d as T,I as te}from"./InputBase-B3N1F7iT.js";const se={multiple:!1},B=y.forwardRef((e,o)=>{const{onChange:n,children:s,multiple:r,accept:f,name:l,form:a,resetRef:i,disabled:d,capture:m,inputProps:h,...R}=_("FileButton",se,e),p=y.useRef(null),b=()=>{var u;!d&&((u=p.current)==null||u.click())},g=u=>{n(r?Array.from(u.currentTarget.files):u.currentTarget.files[0]||null)};return D(i,()=>{p.current&&(p.current.value="")}),t.jsxs(t.Fragment,{children:[s({onClick:b,...R}),t.jsx("input",{style:{display:"none"},type:"file",accept:f,multiple:r,onChange:g,ref:v(o,p),name:l,form:a,capture:m,...h})]})});B.displayName="@mantine/core/FileButton";const oe=({value:e})=>t.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Array.isArray(e)?e.map(o=>o.name).join(", "):e==null?void 0:e.name}),ne={valueComponent:oe},F=q((e,o)=>{const n=_("FileInput",ne,e),{unstyled:s,vars:r,onChange:f,value:l,defaultValue:a,multiple:i,accept:d,name:m,form:h,valueComponent:R,clearable:p,clearButtonProps:b,readOnly:g,capture:C,fileInputProps:u,rightSection:G,size:S,placeholder:k,component:L,resetRef:U,classNames:I,styles:A,...V}=n,x=y.useRef(null),{resolvedClassNames:J,resolvedStyles:z}=K({classNames:I,styles:A,props:n}),[c,E]=ee({value:l,defaultValue:a,onChange:f,finalValue:i?[]:null}),N=Array.isArray(c)?c.length!==0:c!==null,M=G||(p&&N&&!g?t.jsx(H,{...b,variant:"subtle",onClick:()=>E(i?[]:null),size:S,unstyled:s}):null);y.useEffect(()=>{var w;(Array.isArray(c)&&c.length===0||c===null)&&((w=x.current)==null||w.call(x))},[c]);const $=R;return t.jsx(B,{onChange:E,multiple:i,accept:d,name:m,form:h,resetRef:v(x,U),disabled:g,capture:C,inputProps:u,children:w=>t.jsx(T,{component:L||"button",ref:o,rightSection:M,...w,...V,__staticSelector:"FileInput",multiline:!0,type:"button",pointer:!0,__stylesApiProps:n,unstyled:s,size:S,classNames:I,styles:A,children:N?t.jsx($,{value:c}):t.jsx(te.Placeholder,{__staticSelector:"FileInput",classNames:J,styles:z,children:k})})})});F.classes=T.classes;F.displayName="@mantine/core/FileInput";const ae=F,re="The File Name is modified and cannot be accepted to load your goals. Please ensure the file name is exactly as it had been exported as.",le="The content of the file has been modified after being exported. Please export again and do not modify the file content before importing.",ie="Please ensure the file is not modified in any way before importing on another device.";async function O(e){const o=await window.crypto.subtle.digest("SHA-256",new TextEncoder().encode(e));return Array.from(new Uint8Array(o)).map(s=>s.toString(16).padStart(2,"0")).join("")}function ce(e,o){const n=new Blob([JSON.stringify(e)],{type:"application/json"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=`Export-${o}.json`,r.click(),URL.revokeObjectURL(s),r.remove()}function fe(){const{goals:e,saveGoals:o}=Q(),[n,s]=y.useState(!1),r=async()=>{const l=await O(JSON.stringify(e));ce(e,l),j.show({title:"File Exported",message:ie,color:"yellow"})},f=l=>{const a=new FileReader;l&&(a.readAsText(l),a.onload=async()=>{var i;if(a.result&&typeof a.result=="string"){const d=(i=l.name.split("-").at(-1))==null?void 0:i.replace(".json","");if(!/^[0-9a-f]{64}$/.test(d??"")){j.show({title:"File Name Modified",color:"red",message:re,autoClose:1e4});return}const m=await O(a.result);if(d!==m){j.show({title:"File Modified or Renamed",color:"red",autoClose:7500,message:le});return}o([]);const h=JSON.parse(a.result);o(JSON.parse(a.result)),j.show({title:`${h.length} Goals Imported.`,message:"Your goals from file have been imported successfully.",color:"green"}),s(!1)}})};return t.jsxs(X,{ms:"auto",children:[!n&&t.jsxs(W,{gap:"sm",children:[e.length>0&&t.jsx(P,{size:"xs",onClick:r,children:"Export Goals"}),t.jsx(P,{size:"xs",onClick:()=>s(!0),children:"Import Goals"})]}),n&&t.jsxs(Z,{color:"indigo",radius:"md",title:"Import Goals",withCloseButton:!0,onClose:()=>s(!1),children:[t.jsx(ae,{label:"Select Goals File",description:"Select the file you exported from your other device.",placeholder:"Select Goals File",onChange:f}),t.jsx(Y,{mt:"md",c:"red",children:"Please note that importing goals from file will replace any goals you already had created in the system. This action cannot be undone."})]})]})}export{fe as default};
